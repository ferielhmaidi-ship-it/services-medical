{% extends 'base.html.twig' %}

{% block title %}Appointment - MediNest{% endblock %}
{% block body_class %}appointment-page{% endblock %}

{% block body %}

<!-- Page Title -->
<div class="page-title">
  <div class="heading">
    <div class="container">
      <div class="row d-flex justify-content-center text-center">
        <div class="col-lg-8">
          <h1 class="heading-title">Appointment</h1>
          <p class="mb-0">Schedule your appointment with our medical professionals</p>
        </div>
      </div>
    </div>
  </div>
  <nav class="breadcrumbs">
    <div class="container">
      <ol>
        <li><a href="{{ path('app_home') }}">Home</a></li>
        <li class="current">Appointment</li>
      </ol>
    </div>
  </nav>
</div>

<!-- Premium Appointment Section -->
<section id="appointment" class="appointment-section">
  <div class="appointment-bg">
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
  </div>
  
  <div class="container">
    <div class="section-header" data-aos="fade-up">
      <span class="section-tag">Book Your Visit</span>
      <h2 class="section-title">Make an Appointment</h2>
      <p class="section-subtitle">Schedule your consultation with our expert medical professionals</p>
    </div>

    <div class="appointment-card" data-aos="fade-up" data-aos-delay="100">
      <div class="card-glow"></div>
      
      <form action="#" method="post" class="appointment-form" id="appointmentForm">
        <!-- Progress Steps -->
        <div class="form-progress">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <span class="step-label">Personal Info</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <span class="step-label">Details</span>
          </div>
          <div class="progress-line"></div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <span class="step-label">Confirm</span>
          </div>
        </div>

        <!-- Step 1: Personal Information -->
        <div class="form-step active" data-step="1">
          <div class="form-row">
            <div class="form-group">
              <div class="input-wrapper">
                <input type="text" name="name" class="form-input" id="name" placeholder=" " required>
                <label for="name" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Full Name
                </label>
                <span class="input-focus"></span>
              </div>
            </div>

            <div class="form-group">
              <div class="input-wrapper">
                <input type="email" name="email" class="form-input" id="email" placeholder=" " required>
                <label for="email" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                  </svg>
                  Email Address
                </label>
                <span class="input-focus"></span>
              </div>
            </div>

            <div class="form-group">
              <div class="input-wrapper">
                <input type="tel" name="phone" class="form-input" id="phone" placeholder=" " required>
                <label for="phone" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                  </svg>
                  Phone Number
                </label>
                <span class="input-focus"></span>
              </div>
            </div>
          </div>
          
          <div class="step-actions">
            <button type="button" class="btn-next" onclick="nextStep(2)">
              Continue
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </button>
          </div>
        </div>

        <!-- Step 2: Appointment Details -->
        <div class="form-step" data-step="2">
          <div class="form-row">
            <div class="form-group">
              <div class="input-wrapper">
                <input type="date" name="date" class="form-input datepicker" id="date" required>
                <label for="date" class="form-label static">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                  </svg>
                  Preferred Date
                </label>
                <span class="input-focus"></span>
              </div>
            </div>

            <div class="form-group">
              <div class="select-wrapper">
                <select name="department" id="department" class="form-select" required>
                  <option value="" disabled selected>Select Specialty</option>
                  {% for spec in specialites %}
                    <option value="{{ spec.id }}">{{ spec.nom }}</option>
                  {% endfor %}
                </select>
                <label for="department" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
                  </svg>
                  Specialty
                </label>
                <span class="select-arrow"></span>
              </div>
            </div>

            <div class="form-group">
              <div class="select-wrapper">
                <select name="doctor" id="doctor" class="form-select" required disabled>
                  <option value="" disabled selected>Select a specialty first</option>
                </select>
                <label for="doctor" class="form-label">
                  <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  Doctor
                </label>
                <span class="select-arrow"></span>
              </div>
            </div>
          </div>

          <div class="form-group full-width">
            <div class="input-wrapper">
              <textarea name="message" class="form-input textarea" id="message" rows="4" placeholder=" "></textarea>
              <label for="message" class="form-label">
                <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="17" y1="10" x2="3" y2="10"></line>
                  <line x1="21" y1="6" x2="3" y2="6"></line>
                  <line x1="21" y1="14" x2="3" y2="14"></line>
                  <line x1="17" y1="18" x2="3" y2="18"></line>
                </svg>
                Additional Message (Optional)
              </label>
              <span class="char-count">0 / 500</span>
            </div>
          </div>

          <div class="step-actions">
            <button type="button" class="btn-back" onclick="prevStep(1)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Back
            </button>
            <button type="button" class="btn-next" onclick="nextStep(3)">
              Review
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="5" y1="12" x2="19" y2="12"></line>
                <polyline points="12 5 19 12 12 19"></polyline>
              </svg>
            </button>
          </div>
        </div>

        <!-- Step 3: Confirmation -->
        <div class="form-step" data-step="3">
          <div class="confirmation-summary">
            <h3 class="summary-title">Appointment Summary</h3>
            <div class="summary-grid">
              <div class="summary-item">
                <span class="summary-label">Patient</span>
                <span class="summary-value" id="summary-name">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Contact</span>
                <span class="summary-value" id="summary-contact">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Date</span>
                <span class="summary-value" id="summary-date">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Department</span>
                <span class="summary-value" id="summary-department">-</span>
              </div>
              <div class="summary-item">
                <span class="summary-label">Doctor</span>
                <span class="summary-value" id="summary-doctor">-</span>
              </div>
              <div class="summary-item full-width" id="summary-message-container" style="display: none;">
                <span class="summary-label">Message</span>
                <span class="summary-value" id="summary-message">-</span>
              </div>
            </div>
          </div>

          <div class="step-actions">
            <button type="button" class="btn-back" onclick="prevStep(2)">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
              </svg>
              Edit Details
            </button>
            <button type="submit" class="btn-submit">
              <span class="btn-text">Confirm Appointment</span>
              <span class="btn-loader"></span>
              <svg class="btn-check" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </button>
          </div>
        </div>

        <!-- Success Message -->
        <div class="form-success" id="formSuccess">
          <div class="success-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
              <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
          </div>
          <h3 class="success-title">Appointment Confirmed!</h3>
          <p class="success-message">We've sent a confirmation email with all the details.</p>
          <button type="button" class="btn-reset" onclick="resetForm()">Book Another</button>
        </div>
      </form>
    </div>
  </div>
</section>

{% block stylesheets %}
    {{ parent() }}
    <style>
  :root {
    --primary: #0ea5e9;
    --primary-dark: #0284c7;
    --primary-light: #38bdf8;
    --secondary: #8b5cf6;
    --success: #10b981;
    --background: #f0f9ff;
    --surface: rgba(255, 255, 255, 0.9);
    --text-primary: #0f172a;
    --text-secondary: #64748b;
    --border: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    --shadow-glow: 0 0 40px rgba(14, 165, 233, 0.3);
    --radius-sm: 12px;
    --radius-md: 16px;
    --radius-lg: 24px;
  }

  .appointment-section {
    position: relative;
    padding: 100px 0;
    background: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 100%);
    overflow: hidden;
    min-height: 100vh;
    display: flex;
    align-items: center;
  }

  .appointment-bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }

  .floating-shape {
    position: absolute;
    border-radius: 50%;
    filter: blur(60px);
    opacity: 0.5;
    animation: float 20s ease-in-out infinite;
  }

  .shape-1 {
    width: 400px;
    height: 400px;
    background: linear-gradient(135deg, #38bdf8 0%, #0ea5e9 100%);
    top: -10%;
    right: -5%;
    animation-delay: 0s;
  }

  .shape-2 {
    width: 300px;
    height: 300px;
    background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%);
    bottom: -10%;
    left: -5%;
    animation-delay: -5s;
  }

  .shape-3 {
    width: 200px;
    height: 200px;
    background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
    top: 40%;
    left: 20%;
    animation-delay: -10s;
    opacity: 0.3;
  }

  @keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(30px, -30px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 24px;
  }

  /* Section Header */
  .section-header {
    text-align: center;
    margin-bottom: 48px;
  }

  .section-tag {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: linear-gradient(135deg, #e0f2fe 0%, #dbeafe 100%);
    color: var(--primary-dark);
    font-size: 13px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    border-radius: 20px;
    margin-bottom: 16px;
  }

  .section-title {
    font-size: clamp(32px, 5vw, 48px);
    font-weight: 800;
    color: var(--text-primary);
    margin-bottom: 12px;
    letter-spacing: -0.02em;
    background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .section-subtitle {
    font-size: 18px;
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  /* Appointment Card */
  .appointment-card {
    position: relative;
    background: var(--surface);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.6);
    border-radius: var(--radius-lg);
    padding: 48px;
    box-shadow: var(--shadow-lg), 0 0 0 1px rgba(255, 255, 255, 0.5) inset;
    overflow: hidden;
  }

  .card-glow {
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(14, 165, 233, 0.1) 0%, transparent 70%);
    pointer-events: none;
    animation: rotate 30s linear infinite;
  }

  @keyframes rotate {
    to { transform: rotate(360deg); }
  }

  /* Progress Steps */
  .form-progress {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 48px;
    gap: 16px;
  }

  .progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    position: relative;
  }

  .step-number {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: #f1f5f9;
    color: #94a3b8;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 16px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 2px solid transparent;
  }

  .progress-step.active .step-number,
  .progress-step.completed .step-number {
    background: var(--primary-gradient);
    color: #fff;
    box-shadow: 0 8px 20px rgba(14, 165, 233, 0.3);
  }

  .progress-step.completed .step-number {
    background: var(--success);
  }

  .step-label {
    font-size: 13px;
    font-weight: 600;
    color: #94a3b8;
    transition: color 0.3s;
  }

  .progress-step.active .step-label {
    color: var(--primary);
  }

  .progress-line {
    flex: 1;
    height: 2px;
    background: #e2e8f0;
    max-width: 100px;
    position: relative;
    overflow: hidden;
  }

  .progress-line::after {
    content: '';
    position: absolute;
    inset: 0;
    background: var(--success);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s;
  }

  .progress-step.completed + .progress-line::after {
    transform: scaleX(1);
  }

  /* Form Steps */
  .form-step {
    display: none;
    animation: fadeIn 0.5s ease-out;
  }

  .form-step.active {
    display: block;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateX(20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 24px;
    margin-bottom: 24px;
  }

  .form-group {
    position: relative;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  /* Input Styling */
  .input-wrapper,
  .select-wrapper {
    position: relative;
  }

  .form-input,
  .form-select {
    width: 100%;
    height: 64px;
    padding: 24px 16px 8px 48px;
    background: #fff;
    border: 2px solid var(--border);
    border-radius: var(--radius-md);
    font-size: 15px;
    color: var(--text-primary);
    transition: all 0.3s;
    box-shadow: var(--shadow-sm);
  }

  .form-input:focus,
  .form-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1), var(--shadow-md);
  }

  .form-input.textarea {
    height: auto;
    min-height: 120px;
    padding-top: 48px;
    resize: vertical;
  }

  .form-label {
    position: absolute;
    left: 48px;
    top: 50%;
    transform: translateY(-50%);
    color: #94a3b8;
    font-size: 15px;
    font-weight: 500;
    pointer-events: none;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .form-label.static {
    top: 20px;
    transform: none;
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
  }

  .form-input:focus ~ .form-label,
  .form-input:not(:placeholder-shown) ~ .form-label,
  .form-select:focus ~ .form-label,
  .form-select:valid ~ .form-label {
    top: 16px;
    transform: translateY(0);
    font-size: 12px;
    color: var(--primary);
    font-weight: 600;
  }

  .input-icon {
    width: 20px;
    height: 20px;
    color: currentColor;
  }

  .input-focus {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: var(--primary-gradient);
    transition: all 0.3s;
  }

  .form-input:focus ~ .input-focus {
    left: 0;
    width: 100%;
  }

  /* Select Styling */
  .select-wrapper .form-select {
    appearance: none;
    cursor: pointer;
    padding-right: 48px;
  }

  .select-arrow {
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    color: #94a3b8;
    pointer-events: none;
    transition: transform 0.3s;
  }

  .select-wrapper::after {
    content: '';
    position: absolute;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-top: 5px solid #94a3b8;
    pointer-events: none;
    transition: all 0.3s;
  }

  .select-wrapper:focus-within::after {
    border-top-color: var(--primary);
    transform: translateY(-50%) rotate(180deg);
  }

  /* Character Count */
  .char-count {
    position: absolute;
    bottom: 12px;
    right: 16px;
    font-size: 12px;
    color: #94a3b8;
    background: rgba(255, 255, 255, 0.9);
    padding: 2px 8px;
    border-radius: 4px;
  }

  /* Buttons */
  .step-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 32px;
    padding-top: 32px;
    border-top: 1px solid #e2e8f0;
  }

  .btn-next,
  .btn-submit {
    background: var(--primary-gradient);
    border: none;
    color: #fff;
    padding: 16px 32px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
    box-shadow: 0 4px 6px -1px rgba(14, 165, 233, 0.3);
    position: relative;
    overflow: hidden;
  }

  .btn-next::before,
  .btn-submit::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.6s;
  }

  .btn-next:hover,
  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-glow);
  }

  .btn-next:hover::before,
  .btn-submit:hover::before {
    left: 100%;
  }

  .btn-back {
    background: transparent;
    border: 2px solid #e2e8f0;
    color: #64748b;
    padding: 16px 24px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
  }

  .btn-back:hover {
    border-color: var(--primary);
    color: var(--primary);
    background: #f0f9ff;
  }

  /* Submit Button States */
  .btn-submit {
    min-width: 200px;
    justify-content: center;
  }

  .btn-submit.loading .btn-text {
    opacity: 0;
  }

  .btn-loader {
    position: absolute;
    width: 24px;
    height: 24px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: #fff;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    opacity: 0;
  }

  .btn-submit.loading .btn-loader {
    opacity: 1;
  }

  .btn-check {
    position: absolute;
    opacity: 0;
    transform: scale(0);
    transition: all 0.3s;
  }

  .btn-submit.success .btn-check {
    opacity: 1;
    transform: scale(1);
  }

  .btn-submit.success .btn-text,
  .btn-submit.success .btn-loader {
    opacity: 0;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Confirmation Summary */
  .confirmation-summary {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: var(--radius-md);
    padding: 32px;
    margin-bottom: 32px;
    border: 1px solid #e2e8f0;
  }

  .summary-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 24px;
    text-align: center;
  }

  .summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
  }

  .summary-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .summary-item.full-width {
    grid-column: 1 / -1;
  }

  .summary-label {
    font-size: 12px;
    font-weight: 600;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .summary-value {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
  }

  /* Success State */
  .form-success {
    display: none;
    text-align: center;
    padding: 48px;
    animation: fadeIn 0.5s ease-out;
  }

  .form-success.active {
    display: block;
  }

  .success-icon {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px;
    color: #fff;
    box-shadow: 0 12px 24px rgba(16, 185, 129, 0.3);
    animation: scaleIn 0.5s ease-out;
  }

  @keyframes scaleIn {
    from { transform: scale(0); }
    to { transform: scale(1); }
  }

  .success-icon svg {
    width: 40px;
    height: 40px;
  }

  .success-title {
    font-size: 28px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 12px;
  }

  .success-message {
    font-size: 16px;
    color: var(--text-secondary);
    margin-bottom: 32px;
  }

  .btn-reset {
    background: transparent;
    border: 2px solid var(--primary);
    color: var(--primary);
    padding: 14px 28px;
    border-radius: var(--radius-md);
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s;
  }

  .btn-reset:hover {
    background: var(--primary);
    color: #fff;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .appointment-card {
      padding: 32px 24px;
    }

    .form-progress {
      gap: 8px;
    }

    .step-label {
      display: none;
    }

    .form-row {
      grid-template-columns: 1fr;
    }

    .step-actions {
      flex-direction: column-reverse;
      gap: 12px;
    }

    .btn-next,
    .btn-back,
    .btn-submit {
      width: 100%;
      justify-content: center;
    }
  }
</style>
{% endblock %}

<script>
  let currentStep = 1;

  function nextStep(step) {
    if (validateStep(currentStep)) {
      document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
      document.querySelector(`.progress-step[data-step="${currentStep}"]`).classList.add('completed');
      document.querySelector(`.progress-step[data-step="${currentStep}"]`).classList.remove('active');
      
      currentStep = step;
      
      document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
      document.querySelector(`.progress-step[data-step="${currentStep}"]`).classList.add('active');
      
      if (step === 3) {
        updateSummary();
      }
    }
  }

  function prevStep(step) {
    document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.remove('active');
    document.querySelector(`.progress-step[data-step="${step}"]`).classList.remove('completed');
    
    currentStep = step;
    
    document.querySelector(`.form-step[data-step="${currentStep}"]`).classList.add('active');
    document.querySelector(`.progress-step[data-step="${currentStep}"]`).classList.add('active');
  }

  function validateStep(step) {
    const currentStepEl = document.querySelector(`.form-step[data-step="${step}"]`);
    const inputs = currentStepEl.querySelectorAll('input[required], select[required]');
    let valid = true;
    
    inputs.forEach(input => {
      if (!input.value) {
        input.style.borderColor = '#ef4444';
        valid = false;
        setTimeout(() => {
          input.style.borderColor = '';
        }, 2000);
      }
    });
    
    return valid;
  }

  function updateSummary() {
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const date = document.getElementById('date').value;
    const department = document.getElementById('department');
    const doctor = document.getElementById('doctor');
    const message = document.getElementById('message').value;

    document.getElementById('summary-name').textContent = name;
    document.getElementById('summary-contact').textContent = `${email} | ${phone}`;
    document.getElementById('summary-date').textContent = new Date(date).toLocaleDateString('en-US', { 
      weekday: 'long', 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
    document.getElementById('summary-department').textContent = department.options[department.selectedIndex].text;
    document.getElementById('summary-doctor').textContent = doctor.options[doctor.selectedIndex].text;
    
    if (message) {
      document.getElementById('summary-message').textContent = message;
      document.getElementById('summary-message-container').style.display = 'flex';
    }
  }

  // Fetch doctors based on specialty
  document.getElementById('department').addEventListener('change', function() {
    const specialiteId = this.value;
    const doctorSelect = document.getElementById('doctor');
    
    doctorSelect.disabled = true;
    doctorSelect.innerHTML = '<option value="" disabled selected>Loading doctors...</option>';
    
    fetch(`/api/doctors/${specialiteId}`)
      .then(response => response.json())
      .then(data => {
        doctorSelect.innerHTML = '<option value="" disabled selected>Select Doctor</option>';
        if (data.length === 0) {
          doctorSelect.innerHTML = '<option value="" disabled selected>No doctors found</option>';
        } else {
          data.forEach(doctor => {
            const option = document.createElement('option');
            option.value = doctor.id;
            option.textContent = doctor.name;
            doctorSelect.appendChild(option);
          });
          doctorSelect.disabled = false;
        }
      })
      .catch(error => {
        console.error('Error fetching doctors:', error);
        doctorSelect.innerHTML = '<option value="" disabled selected>Error loading doctors</option>';
      });
  });

  // Form submission
  document.getElementById('appointmentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const submitBtn = document.querySelector('.btn-submit');
    const formData = new FormData(this);
    
    submitBtn.classList.add('loading');
    
    fetch('{{ path("app_appointment_submit") }}', {
      method: 'POST',
      body: formData
    })
    .then(response => response.json())
    .then(data => {
      submitBtn.classList.remove('loading');
      
      if (data.status === 'success') {
        submitBtn.classList.add('success');
        setTimeout(() => {
          document.querySelector('.form-step.active').style.display = 'none';
          document.querySelector('.form-progress').style.display = 'none';
          document.getElementById('formSuccess').classList.add('active');
          
          // Smooth scroll to success message
          document.getElementById('formSuccess').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 500);
      } else {
        alert(data.message || 'An error occurred during booking.');
      }
    })
    .catch(error => {
      submitBtn.classList.remove('loading');
      console.error('Error submitting form:', error);
      alert('An error occurred. Please check your connection and try again.');
    });
  });

  function resetForm() {
    document.getElementById('appointmentForm').reset();
    currentStep = 1;
    
    document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
    document.querySelectorAll('.progress-step').forEach(step => {
      step.classList.remove('active', 'completed');
    });
    
    document.querySelector('.form-step[data-step="1"]').classList.add('active');
    document.querySelector('.progress-step[data-step="1"]').classList.add('active');
    
    document.getElementById('formSuccess').classList.remove('active');
    document.querySelector('.form-progress').style.display = 'flex';
    
    document.querySelector('.btn-submit').classList.remove('success');
  }

  // Character counter for textarea
  const textarea = document.getElementById('message');
  const charCount = document.querySelector('.char-count');
  
  textarea.addEventListener('input', function() {
    const length = this.value.length;
    charCount.textContent = `${length} / 500`;
    
    if (length > 450) {
      charCount.style.color = '#ef4444';
    } else if (length > 400) {
      charCount.style.color = '#f59e0b';
    } else {
      charCount.style.color = '#94a3b8';
    }
  });

  // Set min date to today
  const dateInput = document.getElementById('date');
  const today = new Date().toISOString().split('T')[0];
  dateInput.setAttribute('min', today);
</script>
{% endblock %}
