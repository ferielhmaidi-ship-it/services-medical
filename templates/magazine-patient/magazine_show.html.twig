{% extends 'base.html.twig' %}

{% block title %}{{ magazine.title }} | MediNest{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('css/magazine.css') }}">
{% endblock %}

{% block body %}

<!-- ================= HERO SECTION ================= -->  
<section class="mag-hero">
  <div class="container">
    <div class="mag-hero__content">
      <span class="mag-kicker">Magazine Sant√©</span>
      <h1>{{ magazine.title }}</h1>
      <p>{{ magazine.description }}</p>

      <!--  SEARCH -->
      <form action="{{ path('front_magazine_show', {id: magazine.id}) }}" 
            method="get" 
            class="mag-search-form-small">
        <div class="mag-search-group">
          <input 
            type="text" 
            name="search" 
            placeholder="Filtrer les articles..." 
            value="{{ searchTerm }}" 
            class="mag-search-input">
          <button type="submit" class="mag-search-btn">
            üîç
          </button>
        </div>
      </form>

      {% if searchTerm %}
        <div class="mag-search-results">
          Filtre actif : "{{ searchTerm }}"
          <a href="{{ path('front_magazine_show', {id: magazine.id}) }}" 
             class="mag-search-clear">
            Annuler
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</section>


<!-- ================= CONTENT SECTION ================= -->
<section class="mag-section">
  <div class="container">

    <!-- ===== HEADER INFO ===== -->
    <div class="mag-detail__header">
      
      <!-- IMAGE -->
      <div class="mag-detail__media">
        {% if magazine.image %}
          <img src="{{ asset('uploads/' ~ magazine.image) }}" 
               alt="{{ magazine.title }}">
        {% else %}
          <div class="mag-card__placeholder">
            Image non disponible
          </div>
        {% endif %}
      </div>

      <!-- TEXT INFOS -->
      <div class="mag-detail__text">
        <h2>√Ä propos du magazine</h2>
        <p>{{ magazine.description }}</p>

        <p style="margin-top:15px;">
          <strong>Date :</strong> 
          {{ magazine.dateCreate ? magazine.dateCreate|date('d/m/Y') : '' }}
        </p>

        <p>
          <strong>Statut :</strong> 
          <span class="article-tag">{{ magazine.statut }}</span>
        </p>
      </div>
    </div>


    <!-- ================= PDF SECTION ================= -->
    {% if magazine.pdfFile %}
      <div class="mag-pdf-section" style="margin-top:50px;">
        <h2 style="margin-bottom:20px;">Lire le magazine complet</h2>

        <iframe 
          src="{{ asset('uploads/' ~ magazine.pdfFile) }}"
          width="100%"
          height="650px"
          style="
            border:none;
            border-radius:16px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
          ">
        </iframe>
      </div>
    {% endif %}


    <!-- ================= ARTICLES ================= -->
    <div class="mag-articles__header">
      <h2>Articles r√©cents</h2>
      <span class="mag-count">{{ articles|length }} article(s)</span>
    </div>

    <div class="mag-articles">

      {% for article in articles %}
        <article class="article-card">

          {% if article.image %}
            <div class="article-card__image">
              <img src="{{ asset('uploads/' ~ article.image) }}" 
                   alt="{{ article.title }}">
            </div>
          {% endif %}

          <div class="article-card__body">

            <div class="article-card__meta">
              <span>{{ article.auteur }}</span>
              <span>‚Ä¢</span>
              <span>
                {{ article.datePub ? article.datePub|date('d/m/Y') : '' }}
              </span>
            </div>

            <!-- üî• LINK TO ARTICLE SHOW PAGE -->
            <h3>
              <a href="{{ path('front_article_show', { 
                    magazineId: magazine.id, 
                    id: article.id 
                  }) }}"
                 style="text-decoration:none; color:inherit;">
                {{ article.title }}
              </a>
            </h3>

            <p>
              {% if article.resume %}
                {{ article.resume|slice(0, 160) }}
                {% if article.resume|length > 160 %}...{% endif %}
              {% endif %}
            </p>

            <div class="article-card__footer">
              <span class="article-tag">
                {{ article.statut|default('Article') }}
              </span>
            </div>

          </div>

        </article>

      {% else %}
        <div class="mag-empty">
          Aucun article pour ce magazine.
        </div>
      {% endfor %}

    </div>

  </div>
</section>

{% endblock %}
