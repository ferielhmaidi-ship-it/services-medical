<header id="header" class="header d-flex align-items-center fixed-top">
  <div class="container position-relative d-flex align-items-center justify-content-between">

    <!-- Logo -->
    <a href="{{ path('app_home') }}" class="logo d-flex align-items-center me-auto me-xl-0">
      <h1 class="sitename">Tabib<span>Net</span></h1>
    </a>

    <nav id="navmenu" class="navmenu">
      <ul>
        <!-- Accueil -->
        <li><a href="{{ path('app_home') }}" class="{{ app.request.attributes.get('_route') == 'app_home' ? 'active' : '' }}">Accueil</a></li>
        <li><a href="{{ path('app_annuaire') }}" class="{{ app.request.attributes.get('_route') == 'app_annuaire' ? 'active' : '' }}"><i class="fas fa-book-medical me-1"></i>Annuaire Médical</a></li>
        
        <!-- À propos -->
        <li><a href="{{ path('app_about') }}" class="{{ app.request.attributes.get('_route') == 'app_about' ? 'active' : '' }}">À propos</a></li>

        <!-- Services -->
        <li><a href="{{ path('app_services') }}" class="{{ app.request.get('_route') == 'app_services' ? 'active' : '' }}">Services</a></li>

        <!-- Forum -->
        <li><a href="{{ path('question_index') }}" class="{{ app.request.get('_route') starts with 'question_' ? 'active' : '' }}">Forum</a></li>

        <!-- Magazines Dropdown -->
        <li class="dropdown"><a href="#"><span>Magazines</span> <i class="bi bi-chevron-down toggle-dropdown"></i></a>
          <ul>
            <li><a href="{{ url('front_magazine_index') }}">Tous les magazines</a></li>
            <li><a href="{{ url('front_articles_search') }}">Rechercher des articles</a></li>
          </ul>
        </li>

        {% if app.user %}
          <!-- Contenu spécifique à l'utilisateur -->
          {% if is_granted('ROLE_PATIENT') %}
            <!-- Trouver un médecin -->
            <li><a href="{{ path('app_doctors') }}" class="{{ app.request.attributes.get('_route') == 'app_doctors' ? 'active' : '' }}">Trouver un Médecin</a></li>
            
            <!-- Mes rendez-vous -->
            <li><a href="{{ path('app_patient_appointment_list') }}" class="{{ app.request.attributes.get('_route') == 'app_patient_appointment_list' ? 'active' : '' }}">Mes Rendez-vous</a></li>

            <!-- Rapports & Ordonnances -->
            <li>
              <a href="{{ path('patient_reports_prescriptions') }}" class="{{ app.request.attributes.get('_route') == 'patient_reports_prescriptions' ? 'active' : '' }}">
                Rapports &amp; Ordonnances
              </a>
            </li>
          {% endif %}

          {% if is_granted('ROLE_ADMIN') %}
            <li><a href="{{ path('admin_dashboard') }}" class="{{ app.request.attributes.get('_route') starts with 'admin' ? 'active' : '' }}">Panneau Admin</a></li>
          {% endif %}

          {% if is_granted('ROLE_MEDECIN') %}
            <li><a href="{{ path('app_calendrier') }}" class="{{ app.request.attributes.get('_route') == 'app_calendrier' ? 'active' : '' }}">Calendrier</a></li>
            <li><a href="{{ path('app_doctor_appointments') }}" class="{{ app.request.attributes.get('_route') == 'app_doctor_appointments' ? 'active' : '' }}">Mes Rendez-vous</a></li>

            <li class="dropdown">
              <a href="#" class="{{ app.request.attributes.get('_route') starts with 'app_medical_record_' ? 'active' : '' }}">
                <span>Dossier Médicales</span>
                <i class="bi bi-chevron-down toggle-dropdown"></i>
              </a>
              <ul>
                <li><a href="{{ path('pages_dossier_medical') }}">Documents</a></li>
                <li><a href="{{ path('app_medical_record_prescriptions_reports') }}">Ordonnances et Rapports</a></li>
                <li><a href="{{ path('app_medical_record_ai_assistance') }}">Assistance IA</a></li>
              </ul>
            </li>
          {% endif %}
        {% else %}
          <li><a href="{{ path('app_doctors') }}" class="{{ app.request.attributes.get('_route') == 'app_doctors' ? 'active' : '' }}">Trouver un Médecin</a></li>
        {% endif %}

        <!-- Toujours afficher Contact -->
        <li><a href="{{ path('app_contact') }}" class="{{ app.request.attributes.get('_route') == 'app_contact' ? 'active' : '' }}">Contact</a></li>

        <!-- Menu déroulant utilisateur (seulement connecté) -->
        {% if app.user %}
          <li class="dropdown ps-3">
            <a href="#" class="pe-0">
              <span class="d-flex align-items-center">
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px;">
                   {{ app.user.firstName|first|upper }}
                </div>
                <span>{{ app.user.firstName }}</span>
              </span>
              <i class="bi bi-chevron-down toggle-dropdown"></i>
            </a>
            <ul>
              <!-- Tableau de bord selon le rôle -->
              {% if is_granted('ROLE_ADMIN') %}
                <li>
                  <a href="{{ path('admin_dashboard') }}">
                    <i class="fas fa-tachometer-alt me-2"></i>Tableau de bord
                  </a>
                </li>
              {% elseif is_granted('ROLE_MEDECIN') %}
                <li>
                  <a href="{{ path('medecin_dashboard') }}">
                    <i class="fas fa-user-md me-2"></i>Mon Espace
                  </a>
                </li>
              {% elseif is_granted('ROLE_PATIENT') %}
                <li>
                   <a href="{{ path('patient_dashboard') }}">
                    <i class="fas fa-user-injured me-2"></i>Mon Espace
                  </a>
                </li>
              {% endif %}

              <li><hr class="dropdown-divider"></li>

              <li>
                <a href="{{ path('app_logout') }}">
                  <i class="fas fa-sign-out-alt me-2"></i>Déconnexion
                </a>
              </li>
            </ul>
          </li>
        {% else %}
          <li>
            <a href="{{ path('app_login') }}" class="{{ app.request.attributes.get('_route') == 'app_login' ? 'active' : '' }}">
              <i class="fas fa-sign-in-alt me-1"></i>Connexion
            </a>
          </li>
        {% endif %}
      </ul>
      <i class="mobile-nav-toggle d-xl-none bi bi-list"></i>
    </nav>

  </div>
</header>
